# 智能评语系统 - 阿里云服务器部署指令

## 📋 部署信息

- **部署包位置**：`/Users/lijiahao/Desktop/Intelligent Comment System/server-deploy.tar.gz`
- **部署包大小**：6.6 MB
- **服务器地址**：8.134.89.239
- **服务器用户**：root
- **部署目录**：/home/comment-system-api
- **服务端口**：3000

---

## 🚀 部署步骤（请在 Mac 终端执行）

### 步骤1：上传部署包到服务器

```bash
cd "/Users/lijiahao/Desktop/Intelligent Comment System"
scp server-deploy.tar.gz root@8.134.89.239:/root/
```

**说明**：
- 会提示输入服务器密码
- 上传大约需要 10-30 秒（取决于网络速度）
- 看到进度条到达 100% 表示上传完成

---

### 步骤2：SSH 登录服务器

```bash
ssh root@8.134.89.239
```

**说明**：
- 再次输入服务器密码
- 成功登录后会看到服务器的命令提示符

---

### 步骤3：解压并部署（在服务器终端执行）

```bash
cd /root
tar -xzf server-deploy.tar.gz
mv server /home/comment-system-api
cd /home/comment-system-api
chmod +x deploy.sh
bash deploy.sh
```

**说明**：
- 部署脚本会自动检查和安装环境
- 当提示 "请输入选择 (1 或 2)" 时，输入 `1` 进行测试启动
- 服务器启动后会显示详细的启动信息

**预期输出**：
```
🚀 智能评语系统 API 服务已启动
📡 监听端口: 3000
🌐 本地访问: http://localhost:3000
🌐 外网访问: http://8.134.89.239:3000
🔧 环境模式: production
🔑 API Key: 已配置
```

---

## 🧪 部署完成后的测试（在新的终端窗口执行）

### 测试1：健康检查

```bash
curl http://8.134.89.239:3000/health
```

**预期返回**：
```json
{
  "status": "ok",
  "statistics": {
    "totalCodes": 200,
    "activatedCodes": 0,
    "totalQuotaRemaining": 100000
  }
}
```

---

### 测试2：验证激活码

```bash
curl -X POST http://8.134.89.239:3000/api/activation/verify \
  -H "Content-Type: application/json" \
  -d '{"code": "w4JToNx%"}'
```

**预期返回**：
```json
{
  "valid": true,
  "remainingQuota": 500,
  "message": "激活码验证成功"
}
```

---

### 测试3：生成评语（核心功能）⭐

```bash
curl -X POST http://8.134.89.239:3000/api/comment/generate \
  -H "Content-Type: application/json" \
  -d '{
    "code": "w4JToNx%",
    "prompt": "{name}是一个{tags}的孩子，就像一匹活泼可爱的小马驹。{gender}在幼儿园里总是充满活力，和小伙伴们相处得很愉快。希望{name}继续保持这份活力，快乐成长！",
    "studentInfo": {
      "name": "张三",
      "gender": "男",
      "tags": ["活泼", "善良", "好学"]
    }
  }'
```

**预期返回**：
```json
{
  "success": true,
  "comment": "张三是一个活泼、善良、好学的孩子...",
  "remainingQuota": 499
}
```

**✅ 如果返回了评语内容，说明服务器完美运行！**

---

### 测试4：查询额度

```bash
curl http://8.134.89.239:3000/api/quota/check?code=w4JToNx%
```

**预期返回**：
```json
{
  "remainingQuota": 499,
  "activatedAt": "2026-01-20T...",
  "lastUsedAt": "2026-01-20T..."
}
```

---

## 🔧 常见问题处理

### 问题1：端口无法访问

**检查服务器是否在运行**：
```bash
# 在服务器上执行
netstat -tlnp | grep 3000
```

**配置阿里云安全组**：
1. 登录阿里云控制台
2. 进入 ECS 实例 → 安全组配置
3. 添加入方向规则：
   - 端口范围：`3000/3000`
   - 授权对象：`0.0.0.0/0`
   - 协议：`TCP`

---

### 问题2：查看服务器日志

**在服务器上执行**：
```bash
# 查看实时日志
tail -f /home/comment-system-api/logs/output.log

# 查看错误日志
tail -f /home/comment-system-api/logs/error.log
```

---

### 问题3：重启服务器

**在服务器上执行**：
```bash
# 停止当前服务（按 Ctrl+C）
# 然后重新启动
cd /home/comment-system-api
npm start
```

---

## 📊 测试清单

部署完成后，请依次执行4个测试，并确认结果：

- [ ] 测试1：健康检查 - 返回 status: "ok"
- [ ] 测试2：激活码验证 - 返回 valid: true
- [ ] 测试3：生成评语 - 返回评语内容（最重要）
- [ ] 测试4：查询额度 - 返回剩余额度

**全部测试通过后，请告诉我结果，我们将继续开发客户端！**

---

## 🎯 完成后的下一步

服务器部署成功并测试通过后，我们将开始：

- ✨ 阶段4：客户端登录界面开发
- ✨ 阶段5：API集成和请求队列
- ✨ 阶段6：Electron打包

预计剩余开发时间：4-5小时
